var Minipoll=function(e){return this.container=e,this.content=e.querySelectorAll("[data-minipoll-content]")[0],this.messages=e.querySelectorAll("[data-minipoll-messages]")[0],this.ajaxUris={detail:this.container.dataset.minipollAjaxDetail,results:this.container.dataset.minipollAjaxResults,vote:this.container.dataset.minipollAjaxVote},"results"==this.container.dataset.minipollAjax?this.getResults():this.getDetail(),this};Minipoll.prototype.getDetail=function(){this.makeGETRequest(this.ajaxUris.detail)},Minipoll.prototype.getResults=function(){this.makeGETRequest(this.ajaxUris.results)},Minipoll.prototype.postVote=function(e){this.makePOSTRequest(this.ajaxUris.vote,e)},Minipoll.prototype.addMinipollEventListeners=function(e){let t=this.container.querySelectorAll("[data-minipoll-showresult]");if(0<t.length)for(j=0;j<t.length;j++)t[j].addEventListener("click",e=>{e.preventDefault(),this.deleteMessages(),this.getResults()});let i=this.container.querySelectorAll("[data-minipoll-detail]");if(0<i.length)for(j=0;j<i.length;j++)i[j].addEventListener("click",e=>{e.preventDefault(),this.deleteMessages(),this.getDetail()});let s=this.container.querySelectorAll("form[data-minipoll-vote]");if(0<s.length)for(j=0;j<s.length;j++)s[j].addEventListener("submit",e=>{e.preventDefault(),this.deleteMessages(),this.postVote(new URLSearchParams(new FormData(e.target)))})},Minipoll.prototype.makeGETRequest=function(e){this.container.classList.add("tx_minipoll-loading"),fetch(e,{credentials:"same-origin",mode:"same-origin",referrerPolicy:"same-origin"}).then(e=>e.json()).then(e=>{if(e.poll&&e.poll.html)this.content.innerHTML=e.poll.html,this.addMinipollEventListeners(e);else if(e.messages&&e.messages.length)for(y=0;y<e.messages.length;y++)this.showMessage(e.messages[y],!0),console.info('Got a message from server: "'+e.messages[y]+'"');else this.showMessage("Fehler: keine Poll Daten erhalten"),console.error("No poll data received",e);this.content.dispatchEvent(new CustomEvent("minipoll_get",{bubbles:!0,detail:{poll:()=>e.poll}})),this.container.classList.remove("tx_minipoll-loading")})},Minipoll.prototype.makePOSTRequest=function(e,t){this.container.classList.add("tx_minipoll-loading"),fetch(e,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:t,credentials:"same-origin",mode:"same-origin",referrerPolicy:"same-origin",cache:"no-cache",redirect:"error"}).then(e=>e.json()).then(e=>{if(e.poll&&e.poll.html)this.content.innerHTML=e.poll.html,this.addMinipollEventListeners(e);else if(e.messages&&e.messages.length)for(y=0;y<e.messages.length;y++)this.showMessage(e.messages[y],!0),console.info('Got a message from server: "'+e.messages[y]+'"');else this.showMessage("Fehler: keine Poll Daten erhalten"),console.error("No poll data received",e),this.makeGETRequest(this.container.dataset.minipollAjaxDetail);this.content.dispatchEvent(new CustomEvent("minipoll_post",{bubbles:!0,detail:{poll:()=>e.poll}})),this.container.classList.remove("tx_minipoll-loading")})},Minipoll.prototype.showMessage=function(e,t){let i=document.createElement("div");t&&i.classList.add("tx_minipoll-ok"),i.innerText=e,this.messages.appendChild(i)},Minipoll.prototype.deleteMessages=function(){this.messages.innerHTML=""};let minipolls=document.querySelectorAll("div.tx_minipoll-poll[data-minipoll-ajax]");for(let e=0;e<minipolls.length;e++)new Minipoll(minipolls[e]);